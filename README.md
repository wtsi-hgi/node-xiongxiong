# Xiongxiong

Bearer token generator and validator.

## Installation

Install from NPM:

    npm install xiongxiong

## Xiongxiong?

"熊" (xiong, /ɕjʊ̌ŋ/) is Mandarin Chinese for "bear" (as in the mammal).
Reduplication in Mandarin acts as a diminutiviser, so "熊熊" means
something like "little bear".

Bear, bearer, bearer token... Yeah, it's tenuous, but deal with it!

# Documentation

The module *must* be instantiated with a private key and, optionally, a
token lifetime (in seconds).

For example:

```js
var fs         = require('fs'),
    privateKey = fs.readFileSync('/path/to/private.key');

var xiongxiong = require('xiongxiong')(privateKey, 3600);
```

The private key can be any buffer or string; it needn't be read from the
filesystem (but that's probably a good idea). A simple key generation
script is also provided (see below).

The token lifetime defaults to one hour, if omitted.

## `xiongxiong.create(data, callback)`

Asynchronously create the bearer token generated by `data` and pass it
to the `callback`. The callback follows the "error first" pattern, with
any error in the first argument (`null`, otherwise) and the token data
in the second.

The data provided to the function must be a string or an array of
strings. In the latter case, the array is flattened with interposing `:`
characters.

The token data available to the callback is a hash, with keys:
* `expiration` The token's expiration time (Unix epoch)
* `accessToken` The token itself
* `basicLogin` Basic authentication login
* `basicPassword` Basic authentication password

`basicLogin` is the Base64 encoding of the input `data`, with a
cryptographic salt, as a fallback for when HTTP Bearer authentication is
not available. `basicPassword` is the SHA1 HMAC of `basicLogin` with the
private key. The `accessToken` is simply these two pieces concatenated,
again with an interposed `:`.

For example:

```js
xiongxiong.create([userName, sessionID], function(err, token) {
  if (err) {
    throw err;
  }

  console.log(JSON.stringify(token, null, '  '));
});
```

n.b., Don't put `:`s in your seed data; they act as delimiters and
spurious ones will probably mess up with the validation.

## `xiongxiong.isValid(accessToken)`
## `xiongxiong.isValid(basicLogin, basicPassword)`

Validates the bearer token/basic authentication data passed to it,
returning a Boolean.

For example:

```js
if (xiongxiong.isValid(someToken)) {
  // Token validated
  console.log('Get in the van!');
}
```

# `make-key.sh`

A simple wrapper script around `dd` to create a private key file from
`/dev/random`.

## Usage

    make-key.sh [options]

    Options:
      -s SIZE     Key size, in bytes (default 256)
      -o KEYFILE  Key file (default private.key)
      -h          This useful message

# License

Copyright (c) 2014 Genome Research Limited

This program is free software: you can redistribute it and/or modify it
under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or (at
your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the [GNU Affero
General Public License](LICENSE) for more details.

You should have received a copy of the GNU Affero General Public License
along with this program. If not, see <http://www.gnu.org/licenses/>.
